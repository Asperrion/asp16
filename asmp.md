# ASP16 Assembly Language (`.asmp`)

## Общее описание

**ASP16** — учебный 16-битный ассемблер и виртуальный процессор.  
Язык предназначен для написания низкоуровневых программ под простую CPU-архитектуру с фиксированной длиной инструкций, стеком, вызовами функций и memory-mapped I/O.

---

## Основные характеристики

- 16-битная архитектура
- Фиксированная длина инструкции: **4 байта**
- Регистровая модель
- Стек и подпрограммы
- Метки (labels)
- Комментарии
- Memory-mapped I/O
- Двухпроходный ассемблер

---

## Формат программы

```asm
; комментарий
label:
    instruction operand1, operand2

* одна инструкция на строку
* регистры и инструкции — в нижнем регистре
* метка оканчивается `:`
* комментарий начинается с `;`

---

## Комментарии

Всё после `;` игнорируется ассемблером:

```asm
mov ax, 5      ; загрузить 5 в ax
```

---

## Регистры

| Регистр | Назначение                       |
| ------- | -------------------------------- |
| `ax`    | основной аккумулятор             |
| `bx`    | регистр общего назначения        |
| `cx`    | регистр общего назначения        |
| `dx`    | регистр общего назначения        |
| `sp`    | указатель стека                  |
| `ip`    | указатель инструкции (служебный) |

---

## Метки (Labels)

Метки используются для переходов, вызовов функций и адресации памяти.

```asm
start:
    mov ax, 10
    jmp start
```

Каждая инструкция занимает **4 байта**, адрес метки считается автоматически.

---

## Инструкции

### `mov` — перемещение данных

```asm
mov reg, reg
mov reg, imm
```

Примеры:

```asm
mov ax, 5
mov bx, ax
```

---

### `add` — сложение

```asm
add reg, reg
```

```asm
add ax, bx
```

Результат сохраняется в первый регистр.

---

### `load` — загрузка из памяти

```asm
load reg, address
load reg, label
```

```asm
load ax, 0x2000
```

---

### `store` — запись в память

```asm
store reg, address
store reg, label
```

```asm
store ax, 0x3000
```

---

### `push` — поместить в стек

```asm
push reg
```

---

### `pop` — извлечь из стека

```asm
pop reg
```

---

### `call` — вызов подпрограммы

```asm
call label
call address
```

```asm
call print
```

Адрес возврата автоматически сохраняется в стеке.

---

### `ret` — возврат из подпрограммы

```asm
ret
```

---

### `jmp` — безусловный переход

```asm
jmp label
jmp address
```

---

### `nop` — пустая инструкция

```asm
nop
```

---

### `hlt` — остановка процессора

```asm
hlt
```

Останавливает выполнение программы.

---

## Memory-Mapped I/O

ASP16 использует вывод через специальные адреса памяти.

### Вывод символа

**Адрес:** `0xFF00`

```asm
mov ax, 65     ; 'A'
store ax, 0xFF00
```

Выводит ASCII-символ.

---

### Вывод числа

**Адрес:** `0xFF02`

```asm
mov ax, 1337
store ax, 0xFF02
```

Выводит число в stdout.

---

## Пример программы

```asm
; Hello + number

mov ax, 72
store ax, 0xFF00

mov ax, 101
store ax, 0xFF00

mov ax, 108
store ax, 0xFF00

mov ax, 108
store ax, 0xFF00

mov ax, 111
store ax, 0xFF00

mov ax, 10
store ax, 0xFF00

mov ax, 1337
store ax, 0xFF02

hlt
```

Вывод:

```
Hello
1337
```

---

## Ограничения

* нет условных переходов
* немедленные значения `mov` — 8-битные
* нет ввода
* одна инструкция = 4 байта